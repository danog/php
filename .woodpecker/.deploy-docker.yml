matrix:
  variant:
    - "alpineedge/cli"
    - "alpineedge/fpm"
    - "sid/cli"
    - "sid/fpm"
  platform:
    - linux/riscv64

clone:
  git:
    when:
      event:
        - push
    image: woodpeckerci/plugin-git:v1.5.0
    settings:
      depth: 1
      lfs: false
      recursive: false
      tags: true

pipeline:
  docker:
    image: woodpeckerci/plugin-docker-buildx
    secrets: [docker_username, docker_password]
    settings:
      repo: danog/php
      dockerfile: "8.2/${variant}/Dockerfile"
      platforms: ${platform}
      tag: 8.2-${variant}
    when:
      event:
        - push
  
  docker-latest:
    image: woodpeckerci/plugin-docker-buildx
    secrets: [docker_username, docker_password]
    settings:
      repo: danog/madelineproto
      dockerfile: "8.2/sid/cli/Dockerfile"
      platforms: ${platform}
      tag: latest
    when:
      event:
        - push

  docker-latest-8.2:
    image: woodpeckerci/plugin-docker-buildx
    secrets: [docker_username, docker_password]
    settings:
      repo: danog/madelineproto
      dockerfile: "8.2/sid/cli/Dockerfile"
      platforms: ${platform}
      tag: 8.2
    when:
      event:
        - push